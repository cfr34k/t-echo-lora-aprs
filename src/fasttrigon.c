#include <stdbool.h>

#include "fasttrigon.h"

static const int16_t LUT[FASTTRIGON_LUT_SIZE] = {
	0, 25, 50, 75, 100, 125, 150, 175, 201, 226, 251, 276, 301, 326, 351, 376, 401,
	427, 452, 477, 502, 527, 552, 577, 602, 627, 652, 677, 702, 727, 752, 777, 802,
	827, 852, 877, 902, 927, 952, 977, 1002, 1027, 1052, 1077, 1102, 1127, 1152,
	1177, 1201, 1226, 1251, 1276, 1301, 1326, 1350, 1375, 1400, 1425, 1449, 1474,
	1499, 1524, 1548, 1573, 1598, 1622, 1647, 1671, 1696, 1721, 1745, 1770, 1794,
	1819, 1843, 1868, 1892, 1917, 1941, 1965, 1990, 2014, 2039, 2063, 2087, 2112,
	2136, 2160, 2184, 2208, 2233, 2257, 2281, 2305, 2329, 2353, 2377, 2401, 2425,
	2449, 2473, 2497, 2521, 2545, 2569, 2593, 2617, 2641, 2664, 2688, 2712, 2735,
	2759, 2783, 2806, 2830, 2854, 2877, 2901, 2924, 2948, 2971, 2994, 3018, 3041,
	3064, 3088, 3111, 3134, 3157, 3181, 3204, 3227, 3250, 3273, 3296, 3319, 3342,
	3365, 3388, 3411, 3434, 3456, 3479, 3502, 3525, 3547, 3570, 3592, 3615, 3638,
	3660, 3682, 3705, 3727, 3750, 3772, 3794, 3817, 3839, 3861, 3883, 3905, 3927,
	3949, 3971, 3993, 4015, 4037, 4059, 4081, 4103, 4124, 4146, 4168, 4189, 4211,
	4232, 4254, 4275, 4297, 4318, 4339, 4361, 4382, 4403, 4424, 4445, 4467, 4488,
	4509, 4530, 4550, 4571, 4592, 4613, 4634, 4654, 4675, 4696, 4716, 4737, 4757,
	4778, 4798, 4818, 4839, 4859, 4879, 4899, 4919, 4940, 4960, 4980, 4999, 5019,
	5039, 5059, 5079, 5098, 5118, 5138, 5157, 5177, 5196, 5216, 5235, 5254, 5273,
	5293, 5312, 5331, 5350, 5369, 5388, 5407, 5426, 5444, 5463, 5482, 5501, 5519,
	5538, 5556, 5575, 5593, 5611, 5630, 5648, 5666, 5684, 5702, 5720, 5738, 5756,
	5774, 5792, 5810, 5827, 5845, 5862, 5880, 5897, 5915, 5932, 5949, 5967, 5984,
	6001, 6018, 6035, 6052, 6069, 6086, 6103, 6119, 6136, 6153, 6169, 6186, 6202,
	6219, 6235, 6251, 6267, 6284, 6300, 6316, 6332, 6348, 6363, 6379, 6395, 6411,
	6426, 6442, 6457, 6473, 6488, 6503, 6519, 6534, 6549, 6564, 6579, 6594, 6609,
	6624, 6638, 6653, 6668, 6682, 6697, 6711, 6726, 6740, 6754, 6768, 6782, 6796,
	6810, 6824, 6838, 6852, 6866, 6879, 6893, 6907, 6920, 6934, 6947, 6960, 6973,
	6987, 7000, 7013, 7026, 7038, 7051, 7064, 7077, 7089, 7102, 7114, 7127, 7139,
	7151, 7164, 7176, 7188, 7200, 7212, 7224, 7236, 7247, 7259, 7271, 7282, 7294,
	7305, 7316, 7328, 7339, 7350, 7361, 7372, 7383, 7394, 7405, 7415, 7426, 7436,
	7447, 7457, 7468, 7478, 7488, 7498, 7508, 7518, 7528, 7538, 7548, 7558, 7567,
	7577, 7587, 7596, 7605, 7615, 7624, 7633, 7642, 7651, 7660, 7669, 7678, 7686,
	7695, 7704, 7712, 7721, 7729, 7737, 7745, 7754, 7762, 7770, 7778, 7785, 7793,
	7801, 7809, 7816, 7824, 7831, 7838, 7846, 7853, 7860, 7867, 7874, 7881, 7888,
	7894, 7901, 7908, 7914, 7920, 7927, 7933, 7939, 7946, 7952, 7958, 7963, 7969,
	7975, 7981, 7986, 7992, 7997, 8003, 8008, 8013, 8019, 8024, 8029, 8034, 8038,
	8043, 8048, 8053, 8057, 8062, 8066, 8070, 8075, 8079, 8083, 8087, 8091, 8095,
	8099, 8102, 8106, 8110, 8113, 8116, 8120, 8123, 8126, 8129, 8132, 8135, 8138,
	8141, 8144, 8146, 8149, 8152, 8154, 8156, 8159, 8161, 8163, 8165, 8167, 8169,
	8171, 8172, 8174, 8176, 8177, 8179, 8180, 8181, 8182, 8183, 8184, 8185, 8186,
	8187, 8188, 8189, 8189, 8190, 8190, 8190, 8191, 8191, 8191, 8191, 8191, 8191,
	8191, 8190, 8190, 8190, 8189, 8189, 8188, 8187, 8186, 8185, 8184, 8183, 8182,
	8181, 8180, 8179, 8177, 8176, 8174, 8172, 8171, 8169, 8167, 8165, 8163, 8161,
	8159, 8156, 8154, 8152, 8149, 8146, 8144, 8141, 8138, 8135, 8132, 8129, 8126,
	8123, 8120, 8116, 8113, 8110, 8106, 8102, 8099, 8095, 8091, 8087, 8083, 8079,
	8075, 8070, 8066, 8062, 8057, 8053, 8048, 8043, 8038, 8034, 8029, 8024, 8019,
	8013, 8008, 8003, 7997, 7992, 7986, 7981, 7975, 7969, 7963, 7958, 7952, 7946,
	7939, 7933, 7927, 7920, 7914, 7908, 7901, 7894, 7888, 7881, 7874, 7867, 7860,
	7853, 7846, 7838, 7831, 7824, 7816, 7809, 7801, 7793, 7785, 7778, 7770, 7762,
	7754, 7745, 7737, 7729, 7721, 7712, 7704, 7695, 7686, 7678, 7669, 7660, 7651,
	7642, 7633, 7624, 7615, 7605, 7596, 7587, 7577, 7567, 7558, 7548, 7538, 7528,
	7518, 7508, 7498, 7488, 7478, 7468, 7457, 7447, 7436, 7426, 7415, 7405, 7394,
	7383, 7372, 7361, 7350, 7339, 7328, 7316, 7305, 7294, 7282, 7271, 7259, 7247,
	7236, 7224, 7212, 7200, 7188, 7176, 7164, 7151, 7139, 7127, 7114, 7102, 7089,
	7077, 7064, 7051, 7038, 7026, 7013, 7000, 6987, 6973, 6960, 6947, 6934, 6920,
	6907, 6893, 6879, 6866, 6852, 6838, 6824, 6810, 6796, 6782, 6768, 6754, 6740,
	6726, 6711, 6697, 6682, 6668, 6653, 6638, 6624, 6609, 6594, 6579, 6564, 6549,
	6534, 6519, 6503, 6488, 6473, 6457, 6442, 6426, 6411, 6395, 6379, 6363, 6348,
	6332, 6316, 6300, 6284, 6267, 6251, 6235, 6219, 6202, 6186, 6169, 6153, 6136,
	6119, 6103, 6086, 6069, 6052, 6035, 6018, 6001, 5984, 5967, 5949, 5932, 5915,
	5897, 5880, 5862, 5845, 5827, 5810, 5792, 5774, 5756, 5738, 5720, 5702, 5684,
	5666, 5648, 5630, 5611, 5593, 5575, 5556, 5538, 5519, 5501, 5482, 5463, 5444,
	5426, 5407, 5388, 5369, 5350, 5331, 5312, 5293, 5273, 5254, 5235, 5216, 5196,
	5177, 5157, 5138, 5118, 5098, 5079, 5059, 5039, 5019, 4999, 4980, 4960, 4940,
	4919, 4899, 4879, 4859, 4839, 4818, 4798, 4778, 4757, 4737, 4716, 4696, 4675,
	4654, 4634, 4613, 4592, 4571, 4550, 4530, 4509, 4488, 4467, 4445, 4424, 4403,
	4382, 4361, 4339, 4318, 4297, 4275, 4254, 4232, 4211, 4189, 4168, 4146, 4124,
	4103, 4081, 4059, 4037, 4015, 3993, 3971, 3949, 3927, 3905, 3883, 3861, 3839,
	3817, 3794, 3772, 3750, 3727, 3705, 3682, 3660, 3638, 3615, 3592, 3570, 3547,
	3525, 3502, 3479, 3456, 3434, 3411, 3388, 3365, 3342, 3319, 3296, 3273, 3250,
	3227, 3204, 3181, 3157, 3134, 3111, 3088, 3064, 3041, 3018, 2994, 2971, 2948,
	2924, 2901, 2877, 2854, 2830, 2806, 2783, 2759, 2735, 2712, 2688, 2664, 2641,
	2617, 2593, 2569, 2545, 2521, 2497, 2473, 2449, 2425, 2401, 2377, 2353, 2329,
	2305, 2281, 2257, 2233, 2208, 2184, 2160, 2136, 2112, 2087, 2063, 2039, 2014,
	1990, 1965, 1941, 1917, 1892, 1868, 1843, 1819, 1794, 1770, 1745, 1721, 1696,
	1671, 1647, 1622, 1598, 1573, 1548, 1524, 1499, 1474, 1449, 1425, 1400, 1375,
	1350, 1326, 1301, 1276, 1251, 1226, 1201, 1177, 1152, 1127, 1102, 1077, 1052,
	1027, 1002, 977, 952, 927, 902, 877, 852, 827, 802, 777, 752, 727, 702, 677,
	652, 627, 602, 577, 552, 527, 502, 477, 452, 427, 401, 376, 351, 326, 301, 276,
	251, 226, 201, 175, 150, 125, 100, 75, 50, 25, 0, -25, -50, -75, -100, -125,
	-150, -175, -201, -226, -251, -276, -301, -326, -351, -376, -401, -427, -452,
	-477, -502, -527, -552, -577, -602, -627, -652, -677, -702, -727, -752, -777,
	-802, -827, -852, -877, -902, -927, -952, -977, -1002, -1027, -1052, -1077,
	-1102, -1127, -1152, -1177, -1201, -1226, -1251, -1276, -1301, -1326, -1350,
	-1375, -1400, -1425, -1449, -1474, -1499, -1524, -1548, -1573, -1598, -1622,
	-1647, -1671, -1696, -1721, -1745, -1770, -1794, -1819, -1843, -1868, -1892,
	-1917, -1941, -1965, -1990, -2014, -2039, -2063, -2087, -2112, -2136, -2160,
	-2184, -2208, -2233, -2257, -2281, -2305, -2329, -2353, -2377, -2401, -2425,
	-2449, -2473, -2497, -2521, -2545, -2569, -2593, -2617, -2641, -2664, -2688,
	-2712, -2735, -2759, -2783, -2806, -2830, -2854, -2877, -2901, -2924, -2948,
	-2971, -2994, -3018, -3041, -3064, -3088, -3111, -3134, -3157, -3181, -3204,
	-3227, -3250, -3273, -3296, -3319, -3342, -3365, -3388, -3411, -3434, -3456,
	-3479, -3502, -3525, -3547, -3570, -3592, -3615, -3638, -3660, -3682, -3705,
	-3727, -3750, -3772, -3794, -3817, -3839, -3861, -3883, -3905, -3927, -3949,
	-3971, -3993, -4015, -4037, -4059, -4081, -4103, -4124, -4146, -4168, -4189,
	-4211, -4232, -4254, -4275, -4297, -4318, -4339, -4361, -4382, -4403, -4424,
	-4445, -4467, -4488, -4509, -4530, -4550, -4571, -4592, -4613, -4634, -4654,
	-4675, -4696, -4716, -4737, -4757, -4778, -4798, -4818, -4839, -4859, -4879,
	-4899, -4919, -4940, -4960, -4980, -4999, -5019, -5039, -5059, -5079, -5098,
	-5118, -5138, -5157, -5177, -5196, -5216, -5235, -5254, -5273, -5293, -5312,
	-5331, -5350, -5369, -5388, -5407, -5426, -5444, -5463, -5482, -5501, -5519,
	-5538, -5556, -5575, -5593, -5611, -5630, -5648, -5666, -5684, -5702, -5720,
	-5738, -5756, -5774, -5792, -5810, -5827, -5845, -5862, -5880, -5897, -5915,
	-5932, -5949, -5967, -5984, -6001, -6018, -6035, -6052, -6069, -6086, -6103,
	-6119, -6136, -6153, -6169, -6186, -6202, -6219, -6235, -6251, -6267, -6284,
	-6300, -6316, -6332, -6348, -6363, -6379, -6395, -6411, -6426, -6442, -6457,
	-6473, -6488, -6503, -6519, -6534, -6549, -6564, -6579, -6594, -6609, -6624,
	-6638, -6653, -6668, -6682, -6697, -6711, -6726, -6740, -6754, -6768, -6782,
	-6796, -6810, -6824, -6838, -6852, -6866, -6879, -6893, -6907, -6920, -6934,
	-6947, -6960, -6973, -6987, -7000, -7013, -7026, -7038, -7051, -7064, -7077,
	-7089, -7102, -7114, -7127, -7139, -7151, -7164, -7176, -7188, -7200, -7212,
	-7224, -7236, -7247, -7259, -7271, -7282, -7294, -7305, -7316, -7328, -7339,
	-7350, -7361, -7372, -7383, -7394, -7405, -7415, -7426, -7436, -7447, -7457,
	-7468, -7478, -7488, -7498, -7508, -7518, -7528, -7538, -7548, -7558, -7567,
	-7577, -7587, -7596, -7605, -7615, -7624, -7633, -7642, -7651, -7660, -7669,
	-7678, -7686, -7695, -7704, -7712, -7721, -7729, -7737, -7745, -7754, -7762,
	-7770, -7778, -7785, -7793, -7801, -7809, -7816, -7824, -7831, -7838, -7846,
	-7853, -7860, -7867, -7874, -7881, -7888, -7894, -7901, -7908, -7914, -7920,
	-7927, -7933, -7939, -7946, -7952, -7958, -7963, -7969, -7975, -7981, -7986,
	-7992, -7997, -8003, -8008, -8013, -8019, -8024, -8029, -8034, -8038, -8043,
	-8048, -8053, -8057, -8062, -8066, -8070, -8075, -8079, -8083, -8087, -8091,
	-8095, -8099, -8102, -8106, -8110, -8113, -8116, -8120, -8123, -8126, -8129,
	-8132, -8135, -8138, -8141, -8144, -8146, -8149, -8152, -8154, -8156, -8159,
	-8161, -8163, -8165, -8167, -8169, -8171, -8172, -8174, -8176, -8177, -8179,
	-8180, -8181, -8182, -8183, -8184, -8185, -8186, -8187, -8188, -8189, -8189,
	-8190, -8190, -8190, -8191, -8191, -8191, -8191, -8191, -8191, -8191, -8190,
	-8190, -8190, -8189, -8189, -8188, -8187, -8186, -8185, -8184, -8183, -8182,
	-8181, -8180, -8179, -8177, -8176, -8174, -8172, -8171, -8169, -8167, -8165,
	-8163, -8161, -8159, -8156, -8154, -8152, -8149, -8146, -8144, -8141, -8138,
	-8135, -8132, -8129, -8126, -8123, -8120, -8116, -8113, -8110, -8106, -8102,
	-8099, -8095, -8091, -8087, -8083, -8079, -8075, -8070, -8066, -8062, -8057,
	-8053, -8048, -8043, -8038, -8034, -8029, -8024, -8019, -8013, -8008, -8003,
	-7997, -7992, -7986, -7981, -7975, -7969, -7963, -7958, -7952, -7946, -7939,
	-7933, -7927, -7920, -7914, -7908, -7901, -7894, -7888, -7881, -7874, -7867,
	-7860, -7853, -7846, -7838, -7831, -7824, -7816, -7809, -7801, -7793, -7785,
	-7778, -7770, -7762, -7754, -7745, -7737, -7729, -7721, -7712, -7704, -7695,
	-7686, -7678, -7669, -7660, -7651, -7642, -7633, -7624, -7615, -7605, -7596,
	-7587, -7577, -7567, -7558, -7548, -7538, -7528, -7518, -7508, -7498, -7488,
	-7478, -7468, -7457, -7447, -7436, -7426, -7415, -7405, -7394, -7383, -7372,
	-7361, -7350, -7339, -7328, -7316, -7305, -7294, -7282, -7271, -7259, -7247,
	-7236, -7224, -7212, -7200, -7188, -7176, -7164, -7151, -7139, -7127, -7114,
	-7102, -7089, -7077, -7064, -7051, -7038, -7026, -7013, -7000, -6987, -6973,
	-6960, -6947, -6934, -6920, -6907, -6893, -6879, -6866, -6852, -6838, -6824,
	-6810, -6796, -6782, -6768, -6754, -6740, -6726, -6711, -6697, -6682, -6668,
	-6653, -6638, -6624, -6609, -6594, -6579, -6564, -6549, -6534, -6519, -6503,
	-6488, -6473, -6457, -6442, -6426, -6411, -6395, -6379, -6363, -6348, -6332,
	-6316, -6300, -6284, -6267, -6251, -6235, -6219, -6202, -6186, -6169, -6153,
	-6136, -6119, -6103, -6086, -6069, -6052, -6035, -6018, -6001, -5984, -5967,
	-5949, -5932, -5915, -5897, -5880, -5862, -5845, -5827, -5810, -5792, -5774,
	-5756, -5738, -5720, -5702, -5684, -5666, -5648, -5630, -5611, -5593, -5575,
	-5556, -5538, -5519, -5501, -5482, -5463, -5444, -5426, -5407, -5388, -5369,
	-5350, -5331, -5312, -5293, -5273, -5254, -5235, -5216, -5196, -5177, -5157,
	-5138, -5118, -5098, -5079, -5059, -5039, -5019, -4999, -4980, -4960, -4940,
	-4919, -4899, -4879, -4859, -4839, -4818, -4798, -4778, -4757, -4737, -4716,
	-4696, -4675, -4654, -4634, -4613, -4592, -4571, -4550, -4530, -4509, -4488,
	-4467, -4445, -4424, -4403, -4382, -4361, -4339, -4318, -4297, -4275, -4254,
	-4232, -4211, -4189, -4168, -4146, -4124, -4103, -4081, -4059, -4037, -4015,
	-3993, -3971, -3949, -3927, -3905, -3883, -3861, -3839, -3817, -3794, -3772,
	-3750, -3727, -3705, -3682, -3660, -3638, -3615, -3592, -3570, -3547, -3525,
	-3502, -3479, -3456, -3434, -3411, -3388, -3365, -3342, -3319, -3296, -3273,
	-3250, -3227, -3204, -3181, -3157, -3134, -3111, -3088, -3064, -3041, -3018,
	-2994, -2971, -2948, -2924, -2901, -2877, -2854, -2830, -2806, -2783, -2759,
	-2735, -2712, -2688, -2664, -2641, -2617, -2593, -2569, -2545, -2521, -2497,
	-2473, -2449, -2425, -2401, -2377, -2353, -2329, -2305, -2281, -2257, -2233,
	-2208, -2184, -2160, -2136, -2112, -2087, -2063, -2039, -2014, -1990, -1965,
	-1941, -1917, -1892, -1868, -1843, -1819, -1794, -1770, -1745, -1721, -1696,
	-1671, -1647, -1622, -1598, -1573, -1548, -1524, -1499, -1474, -1449, -1425,
	-1400, -1375, -1350, -1326, -1301, -1276, -1251, -1226, -1201, -1177, -1152,
	-1127, -1102, -1077, -1052, -1027, -1002, -977, -952, -927, -902, -877, -852,
	-827, -802, -777, -752, -727, -702, -677, -652, -627, -602, -577, -552, -527,
	-502, -477, -452, -427, -401, -376, -351, -326, -301, -276, -251, -226, -201,
	-175, -150, -125, -100, -75, -50, -25
};

int32_t fasttrigon_sin(int32_t arg)
{
	bool neg = arg < 0;
	uint32_t idx;
	if(neg) {
		idx = (-arg) % FASTTRIGON_LUT_SIZE;
		return -LUT[idx];
	} else {
		idx = arg  % FASTTRIGON_LUT_SIZE;
		return LUT[idx];
	}
}

int32_t fasttrigon_cos(int32_t arg)
{
	return fasttrigon_sin(arg + FASTTRIGON_LUT_SIZE/4);
}

int32_t fasttrigon_tan(int32_t arg)
{
	int32_t denom = fasttrigon_cos(arg);
	if(denom == 0) {
		return 0x7FFFFFFF;
	}

	int32_t numer = fasttrigon_sin(arg);

	return numer * FASTTRIGON_SCALE / denom;
}
